# 4장 테스트 조직

## AAA 로 테스트 일관성 유지
- 우리는 테스트코드 작성시 3단계로 구분 (준비, 실행, 단언) 하여 작성 했다.
- 이것을 트리플 - A 라고도 한다.
  - 각 부분을 명시적으로 식별하기 위해 주석을 넣기도 한다.
- AAA 는 다음과 같은 일을 할 수 있다.
  - 준비 (Arrange) : 테스트 코드 실행 전 각 시스템이 적절한 상태에 있는지 확인
    - 객체들을 생성하거나, 다른 API 들을 호출하는 등..
  - 실행 (Act) : 테스트 코드를 실행 (일반적으로 단일 메소드를 호출)
  - 단언 (Assert) : 실행한 코드가 기대한 대로 동작하는지 확인
- 위 3 단계는 필수적이고, 경우에 따라 4번째 단계가 필요하기도 한다.
  - 사후 (After) : 테스트 실행시 자원을 할당했다면 이를 정리 (Clean-Up)

## 동작 테스트와 메소드 테스트
- 테스트 작성시에는 **클래스의 동작** 에 집중해야 하며, 개발 메소드를 테스트해서는 안된다.
- ATM 클래스를 예로들면, 해당 클래스 메소드는 deposit, withdraw, getBalance 가 있다고 가정한다.
- 가장 먼저 작성해볼 만한 테스트는 다음과 같을 것이다.
  - makeSingleDeposit
  - makeMultipleDeposits
- 위 테스트는 **입금** 처리에 대한 테스트이고, 이들을 검증하려면 getBalance() 를 호출해야 한다.
- 하지만 getBalance() 에 대한 테스트는 만들고 싶지 않을 것임.. -> 단순 필드만 반환하기 때문에 의미가 없다.
- 테스트 대상이 될만한 **동작** 에는 입금과 출금 같은 동작이 먼저 나와야 한다.
- **출금 테스트** 를 하기 위해서는 먼저 **입금 테스트** 가 선행되어야 한다.
  - 잔고를 가지는 ATM 객체를 초기화 하기 위해서는 입금을 해야한다.
- 단위 테스트 작성시에는 **전체적인 시각에서 출발** 해야 한다.
- 개별 메소드를 테스트하는 것이 아닌, 클래스의 **종합적인 동작** 을 테스트한다는 생각을 가져야 한다.

## 테스트와 프로덕션 코드의 관계
- 테스트는 프로젝트 내에서 프로덕션 코드와 분리해야 한다.
- 단위 테스트는 개발자만 하는 행동이다.
  - 고객/최종사용자 등은 테스트 결과를 보거나 실행만 한다.
- 프로덕션 코드는 **테스트 코드의 존재를 몰라야한다.**

## 내부 데이터 노출 과 내부 동작 노출
- 어떤 개발자는 테스트 작성시 프로덕션 코드의 퍼블릭 인터페이스만 사용해야 한다고 한다.
- 테스트를 위해 내부 데이터를 노출하는 것은 테스트와 프로덕션 코드사이에 과한 결합을 초래한다.
  - 내부 동작을 노출하는 것은 다른 문제
- private 메소드는 테스트 하지 않는다.
- private 메소드를 테스트해야 한다면 이는 **설계에 문제가 있다**
- 가장 좋은 해결책은 **private 메소드를 별개의 클래스로 추출** 하는 것이다.

## 집중적인 단일 목적 테스트의 가치
- 여러 테스트케이스를 하나의 테스트에 몰아서 넣는것은 좋지 않다.
- 테스트를 분리했을때 발생하는 반복적인 초기화 부담은 줄 수 있겠지만, **테스트 고립의 중요한 이점을 잃게 된다.**
- 테스트 분리시 장점은 다음과 같다.
  - 실패시 실패한 테스트 이름이 표기되기에 어떤 동작에서 실패하는지 **빠른 파악** 이 가능
  - 실패한 테스트를 이해하는데 필요한 시간을 줄일 수 있음
  - 모든 케이스가 실행됨을 보장

## 문서로서의 테스트

`일관성 있는 이름으로 테스트 문서화`
- 테스트 케이스를 단일 메소드로 결합 할수록 이름 또한 일반적이고 의미를 잃는다.
- 작은 테스트로 이동할수록 각각은 **행동에 집중** 하게 된다.
- 합리적인 테스트 이름은 단어 일곱개 정도로 구성되어 있을 것이다.
- 좋은 테스트 이름은 다음과 같은 양식을 따른다.
  - 어떤 동작을 하면, 어떤 결과가 나온다.
  - 어떤 결과는, 어떤 조건에서 발생한다.
- 또는 BDD 에서 말하는 given-when-then 을 활용할 수도 있다.

> 어떤 형식이든 **일관성을 유지** 하는 것이 중요하다. <br/>
> 주요 목표는 테스트 코드를 다른사람에게 의미있게 하는것

`테스트를 의미있게 만들기`
- 지역변수명 개선
- 의미있는 상수 도입
- 햄크레스트 단언 사용
- 테스트를 작게 나누기
- 테스트 군더더기를 helper 메소드와 @Before 로 이동하기

## @Before @After
- @Before 를 사용해 중복 초기화 코드를 제거 할 수 있다.
- 만약 여러 @Before 메소드가 있다면, 주의 해야 한다.
- @Before 메소드 간의 **호출 순서** 를 보장하지 않는다.
- 순서 보장이 필요하다면 메소드로 결합하여 순서실행을 보장해야 한다.

## 녹색이 좋다: 테스트를 의미있게 유지
- 보통 모든 테스트가 항상 통과한다고 기대해야 한다.
- 실패하는 테스트가 있다면 더 늘리지 말고, 실패하는 테스트를 고쳐 모든 테스트가 항상 통과하도록 해야 한다.

## 테스트 제외
- 여러 테스트가 실패한다면 한 가지 해결책은 주석처리 해버리는 것이다.
- 하지만 JUnit 은 @Ignore 애노테이션이라는 더 나은해결책을 제공한다.
- 이는 테스트 결과에서도 몇개의 테스트가 무시되었는지 알려준다.